ä¸€ã€å»ºç«‹ PushTemplate è³‡æ–™è¡¨ï¼ˆPrisma schemaï¼‰
prisma
è¤‡è£½
ç·¨è¼¯
model PushTemplate {
  id          String   @id @default(uuid())
  name        String
  description String?
  json        Json
  createdAt   DateTime @default(now())
}
ğŸ‘‰ ç„¶å¾ŒåŸ·è¡Œï¼š

bash
è¤‡è£½
ç·¨è¼¯
npx prisma migrate dev --name create_push_template
âœ… äºŒã€å»ºç«‹ API è·¯ç”±
1. /api/admin/push-template/save.ts
ts
è¤‡è£½
ç·¨è¼¯
import { prisma } from "@/lib/prisma";
import { NextApiRequest, NextApiResponse } from "next";

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== "POST") return res.status(405).end();

  const { name, description, json } = req.body;

  if (!name || !json) {
    return res.status(400).json({ message: "ç¼ºå°‘å¿…è¦æ¬„ä½" });
  }

  const template = await prisma.pushTemplate.create({
    data: {
      name,
      description,
      json,
    },
  });

  return res.status(200).json({ success: true, template });
}
2. /api/admin/push/test.ts
ts
è¤‡è£½
ç·¨è¼¯
import { client } from "@/lib/lineClient"; // å·²åˆå§‹åŒ– LINE Bot Client
import { NextApiRequest, NextApiResponse } from "next";

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== "POST") return res.status(405).end();

  const { userId, messageJson } = req.body;

  if (!userId || !messageJson) {
    return res.status(400).json({ message: "ç¼ºå°‘ userId æˆ– messageJson" });
  }

  try {
    await client.pushMessage(userId, {
      type: "flex",
      altText: "Flex æ¨æ’­é è¦½",
      contents: messageJson,
    });

    return res.status(200).json({ success: true });
  } catch (error) {
    console.error("æ¨æ’­éŒ¯èª¤", error);
    return res.status(500).json({ success: false, error });
  }
}
âœ… ä¸‰ã€å‰ç«¯æ•´åˆï¼šåœ¨ /admin/push-template.tsx åŠ å…¥åº•éƒ¨åŠŸèƒ½å€
tsx
è¤‡è£½
ç·¨è¼¯
const [templateName, setTemplateName] = useState("");
const [templateDesc, setTemplateDesc] = useState("");
const [testUserId, setTestUserId] = useState("");

...

<div className="mt-6 space-y-4">
  <div>
    <h2 className="text-md font-semibold">ğŸ’¾ å„²å­˜æ¨£æ¿</h2>
    <input
      placeholder="æ¨£æ¿åç¨±"
      value={templateName}
      onChange={(e) => setTemplateName(e.target.value)}
      className="border px-2 py-1 mr-2 rounded w-60"
    />
    <input
      placeholder="æè¿°ï¼ˆå¯é¸ï¼‰"
      value={templateDesc}
      onChange={(e) => setTemplateDesc(e.target.value)}
      className="border px-2 py-1 mr-2 rounded w-80"
    />
    <button
      className="bg-green-600 text-white px-4 py-1 rounded"
      onClick={async () => {
        const res = await fetch("/api/admin/push-template/save", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: templateName,
            description: templateDesc,
            json: parsed,
          }),
        });

        if (res.ok) {
          alert("âœ… æ¨£æ¿å·²å„²å­˜");
        } else {
          alert("âŒ å„²å­˜å¤±æ•—");
        }
      }}
    >
      å„²å­˜æ¨£æ¿
    </button>
  </div>

  <div>
    <h2 className="text-md font-semibold">ğŸ§ª æ¸¬è©¦æ¨æ’­</h2>
    <input
      placeholder="LINE UserId"
      value={testUserId}
      onChange={(e) => setTestUserId(e.target.value)}
      className="border px-2 py-1 mr-2 rounded w-[360px]"
    />
    <button
      className="bg-blue-600 text-white px-4 py-1 rounded"
      onClick={async () => {
        const res = await fetch("/api/admin/push/test", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId: testUserId, messageJson: parsed }),
        });

        if (res.ok) {
          alert("âœ… æ¨æ’­æˆåŠŸï¼");
        } else {
          alert("âŒ æ¨æ’­å¤±æ•—");
        }
      }}
    >
      ç™¼é€æ¸¬è©¦è¨Šæ¯
    </button>
  </div>
</div>
âœ… æˆæœæ•´ç†
åŠŸèƒ½	ç‹€æ…‹
ğŸ“„ Prisma è³‡æ–™è¡¨å»ºç«‹	âœ… PushTemplate
ğŸ’¾ å„²å­˜æ¨£æ¿ API	âœ… /api/admin/push-template/save
ğŸ§ª æ¸¬è©¦æ¨æ’­ API	âœ… /api/admin/push/test
å‰ç«¯æ•´åˆ	âœ… è¡¨å–® + å³æ™‚ç™¼é€æŒ‰éˆ•