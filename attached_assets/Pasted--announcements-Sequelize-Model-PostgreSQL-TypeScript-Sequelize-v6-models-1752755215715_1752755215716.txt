ä»¥ä¸‹æ˜¯ç‚º announcements è³‡æ–™è¡¨æ’°å¯«çš„ Sequelize Modelï¼Œæ”¯æ´ PostgreSQLï¼Œèªè¨€ç‚º TypeScriptï¼Œä½¿ç”¨ Sequelize v6 æ¨™æº–ã€‚

âœ… models/announcement.ts
ts
è¤‡è£½
ç·¨è¼¯
import {
  Model,
  DataTypes,
  Optional,
  Sequelize,
  InferAttributes,
  InferCreationAttributes,
  CreationOptional,
  ForeignKey,
} from 'sequelize';

export interface AnnouncementAttributes extends InferAttributes<Announcement> {
  id: number;
  title: string;
  content: string;
  related_event_id?: number | null;
  created_by?: number | null;
  audience: 'all' | 'officers' | 'members';
  category: 'event' | 'system' | 'personnel';
  status: 'draft' | 'scheduled' | 'published';
  scheduled_at?: Date | null;
  published_at?: Date | null;
  is_visible: boolean;
  created_at?: Date;
  updated_at?: Date;
}

export class Announcement extends Model<
  InferAttributes<Announcement>,
  InferCreationAttributes<Announcement>
> implements AnnouncementAttributes {
  declare id: CreationOptional<number>;
  declare title: string;
  declare content: string;
  declare related_event_id: ForeignKey<number> | null;
  declare created_by: ForeignKey<number> | null;
  declare audience: 'all' | 'officers' | 'members';
  declare category: 'event' | 'system' | 'personnel';
  declare status: 'draft' | 'scheduled' | 'published';
  declare scheduled_at: Date | null;
  declare published_at: Date | null;
  declare is_visible: boolean;
  declare created_at: CreationOptional<Date>;
  declare updated_at: CreationOptional<Date>;

  static initModel(sequelize: Sequelize): typeof Announcement {
    Announcement.init(
      {
        id: {
          type: DataTypes.INTEGER,
          autoIncrement: true,
          primaryKey: true,
        },
        title: {
          type: DataTypes.TEXT,
          allowNull: false,
        },
        content: {
          type: DataTypes.TEXT,
          allowNull: false,
        },
        related_event_id: {
          type: DataTypes.INTEGER,
          allowNull: true,
        },
        created_by: {
          type: DataTypes.INTEGER,
          allowNull: true,
        },
        audience: {
          type: DataTypes.ENUM('all', 'officers', 'members'),
          allowNull: false,
          defaultValue: 'all',
        },
        category: {
          type: DataTypes.ENUM('event', 'system', 'personnel'),
          allowNull: false,
          defaultValue: 'event',
        },
        status: {
          type: DataTypes.ENUM('draft', 'scheduled', 'published'),
          allowNull: false,
          defaultValue: 'draft',
        },
        scheduled_at: {
          type: DataTypes.DATE,
          allowNull: true,
        },
        published_at: {
          type: DataTypes.DATE,
          allowNull: true,
        },
        is_visible: {
          type: DataTypes.BOOLEAN,
          allowNull: false,
          defaultValue: true,
        },
        created_at: {
          type: DataTypes.DATE,
          allowNull: false,
          defaultValue: DataTypes.NOW,
        },
        updated_at: {
          type: DataTypes.DATE,
          allowNull: false,
          defaultValue: DataTypes.NOW,
        },
      },
      {
        sequelize,
        tableName: 'announcements',
        modelName: 'Announcement',
        timestamps: false, // è‹¥ä½ ç”¨ created_at/updated_atï¼Œé€™è£¡éœ€æ‰‹å‹•æ›´æ–°æ™‚é–“
        underscored: true,
      }
    );

    return Announcement;
  }
}
ğŸ”— é—œè¯è¨­å®šï¼ˆæ”¾åœ¨ models/index.ts æˆ–åˆå§‹åŒ–é—œè¯çš„åœ°æ–¹ï¼‰
ts
è¤‡è£½
ç·¨è¼¯
// Announcement é—œè¯ï¼šå¯é¸
Announcement.belongsTo(Member, { foreignKey: 'created_by' });
Announcement.belongsTo(Event, { foreignKey: 'related_event_id' });
