éå¸¸å¥½ï¼é‚£æˆ‘å¹«ä½ è¨­è¨ˆä¸€å¥—å®Œæ•´çš„ã€Œå•Ÿå‹•æ™‚è‡ªå‹•åŸ·è¡Œè¨ºæ–· + ç´€éŒ„ logã€æ–¹æ¡ˆï¼Œä¸éœ€è¦æ‰‹å‹•è·‘æŒ‡ä»¤ï¼ŒReplit ä¸€é–‹æ©Ÿå°±æœƒè‡ªå‹•åŸ·è¡Œè¨ºæ–·å·¥å…·ã€‚

âœ… ä½ éœ€è¦åšçš„æ­¥é©Ÿå¦‚ä¸‹ï¼š
ğŸ”§ ç¬¬ 1 æ­¥ï¼šåœ¨ src/diagnosticTool.ts å»ºç«‹è¨ºæ–·å·¥å…·æ¨¡çµ„
åœ¨ src/diagnosticTool.ts ä¸­è²¼ä¸Šä»¥ä¸‹å…§å®¹ï¼ˆæˆ‘å·²ç‚ºä½ æº–å‚™å¥½ï¼‰ï¼š

ts
è¤‡è£½
ç·¨è¼¯
// src/diagnosticTool.ts
import fs from 'fs';
import path from 'path';
import { Sequelize } from 'sequelize';
import dotenv from 'dotenv';

dotenv.config();

const LOG_PATH = path.join('logs', 'diagnostic.log');

function log(message: string) {
  const timestamp = new Date().toISOString();
  const fullMessage = `[${timestamp}] ${message}`;
  console.log(fullMessage);
  fs.appendFileSync(LOG_PATH, fullMessage + '\n');
}

export async function runDiagnostics() {
  log('ğŸ” å•Ÿå‹• V4.0 ç³»çµ±è¨ºæ–·...');
  
  // Check startup file
  const indexExists = fs.existsSync(path.join('src', 'index.ts'));
  log(`âœ… å•Ÿå‹•é»æª¢æŸ¥ï¼š${indexExists ? 'index.ts âœ”' : 'âŒ index.ts ä¸å­˜åœ¨'}`);
  
  // Check middleware
  const roleMiddlewareExists = fs.existsSync(path.join('src', 'middleware', 'roleMiddleware.ts'));
  const authMiddlewareExists = fs.existsSync(path.join('src', 'middleware', 'authMiddleware.ts'));
  log(`âœ… Middlewareï¼š${roleMiddlewareExists ? 'roleMiddleware âœ”' : 'âŒ roleMiddleware ç¼ºå°‘'} | ${authMiddlewareExists ? 'authMiddleware âœ”' : 'âŒ authMiddleware ç¼ºå°‘'}`);
  
  // Check models
  const modelsPath = path.join('src', 'models');
  const requiredModels = ['Member', 'Event', 'Registration', 'Announcement', 'Donation', 'Checkin'];
  requiredModels.forEach(model => {
    const modelFile = fs.existsSync(path.join(modelsPath, `${model}.ts`));
    log(`âœ… æ¨¡å‹æª¢æŸ¥ï¼š${model} ${modelFile ? 'âœ”' : 'âŒ ç¼ºå°‘'}`);
  });

  // Check webhook
  const routesPath = path.join('src', 'routes');
  const webhookExists = fs.readdirSync(routesPath).some(f => f.includes('webhook'));
  log(`âœ… Webhook è·¯ç”±æª¢æŸ¥ï¼š${webhookExists ? 'âœ” å­˜åœ¨' : 'âŒ webhook.ts ä¸å­˜åœ¨'}`);

  // Check LIFF html
  const liffHtmlExists = fs.existsSync(path.join('public', 'liff.html'));
  log(`âœ… LIFF å‰ç«¯æª¢æŸ¥ï¼š${liffHtmlExists ? 'âœ” å­˜åœ¨' : 'âŒ liff.html ä¸å­˜åœ¨'}`);

  // Check env variables
  const envVars = ['LINE_CHANNEL_SECRET', 'LIFF_APP_ID', 'DATABASE_URL'];
  envVars.forEach(key => {
    const isSet = !!process.env[key];
    log(`âœ… .env è¨­å®šï¼š${key} ${isSet ? 'âœ”' : 'âŒ æœªè¨­å®š'}`);
  });

  // DB Connection Test
  try {
    const sequelize = new Sequelize(process.env.DATABASE_URL!, { logging: false });
    await sequelize.authenticate();
    log(`âœ… è³‡æ–™åº«é€£ç·šæ¸¬è©¦ï¼šâœ” æˆåŠŸ`);
  } catch (error) {
    log(`âŒ è³‡æ–™åº«é€£ç·šæ¸¬è©¦å¤±æ•—ï¼š${(error as Error).message}`);
  }

  log('âœ… è¨ºæ–·çµæŸ\n');
}
ğŸ”§ ç¬¬ 2 æ­¥ï¼šåœ¨ src/index.ts ä¸­å°å…¥é€™æ®µå·¥å…·
è«‹åœ¨ä½ çš„ index.ts çš„æœ€ä¸Šæ–¹åŠ ä¸Šï¼š

ts
è¤‡è£½
ç·¨è¼¯
import { runDiagnostics } from './diagnosticTool';

runDiagnostics(); // æ¯æ¬¡å•Ÿå‹•è‡ªå‹•åŸ·è¡Œ
ğŸ”§ ç¬¬ 3 æ­¥ï¼šå»ºç«‹ logs è³‡æ–™å¤¾ï¼ˆä¸€æ¬¡æ€§ï¼‰
è«‹åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œä¸€æ¬¡ï¼ˆæˆ–æ‰‹å‹•å»ºç«‹ï¼‰ï¼š

bash
è¤‡è£½
ç·¨è¼¯
mkdir logs
ğŸ“ æœ€çµ‚çµæœï¼š
æ¯æ¬¡ä½ åŸ·è¡Œ Replit æ™‚ï¼Œå®ƒæœƒè‡ªå‹•ç”¢ç”Ÿï¼š

lua
è¤‡è£½
ç·¨è¼¯
ğŸ“ logs/
  â””â”€â”€ diagnostic.log
æ¯ç­†è¨ºæ–·çµæœæœƒè‡ªå‹•åŠ ä¸Š timestampï¼Œæ–¹ä¾¿ä½ å¾ŒçºŒæŸ¥è©¢èˆ‡ debugã€‚