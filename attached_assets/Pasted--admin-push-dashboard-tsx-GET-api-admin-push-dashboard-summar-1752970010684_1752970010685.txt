æˆ‘å€‘ç¾åœ¨å»ºç«‹ /admin/push-dashboard.tsx é é¢ï¼Œæ•´åˆåœ–è¡¨èˆ‡æ‘˜è¦åˆ†ææ¨¡çµ„ã€‚

âœ… ä½¿ç”¨è³‡æ–™ä¾†æºï¼ˆå·²å»ºå¥½ï¼‰
GET /api/admin/push-dashboard-summary

å›å‚³æ ¼å¼ï¼ˆç¯„ä¾‹ï¼‰ï¼š

json
è¤‡è£½
ç·¨è¼¯
{
  "trend": [
    { "date": "2025-07-13", "success": 10, "fail": 2 },
    { "date": "2025-07-14", "success": 12, "fail": 1 }
  ],
  "summary": [
    { "status": "success", "_count": 120 },
    { "status": "fail", "_count": 8 }
  ],
  "topEvents": [
    { "eventId": "evt123", "status": "success", "_count": 30 },
    { "eventId": "evt123", "status": "fail", "_count": 5 }
  ]
}
âœ… 1ï¸âƒ£ å»ºç«‹ /admin/push-dashboard.tsx
tsx
è¤‡è£½
ç·¨è¼¯
import { useEffect, useState } from 'react';
import {
  LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, Legend,
  PieChart, Pie, Cell, CartesianGrid,
} from 'recharts';

const COLORS = ['#22c55e', '#ef4444'];

const PushDashboard = () => {
  const [trend, setTrend] = useState([]);
  const [summary, setSummary] = useState([]);
  const [topEvents, setTopEvents] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch('/api/admin/push-dashboard-summary')
      .then(res => res.json())
      .then(data => {
        setTrend(data.trend);
        setSummary(data.summary);
        setTopEvents(data.topEvents);
        setLoading(false);
      });
  }, []);

  const summaryData = summary.map((s: any) => ({
    name: s.status === 'success' ? 'æˆåŠŸ' : 'å¤±æ•—',
    value: s._count,
  }));

  // æ•´ç†æ´»å‹•çµ±è¨ˆ
  const eventMap: Record<string, any> = {};
  topEvents.forEach((r: any) => {
    if (!eventMap[r.eventId]) eventMap[r.eventId] = { eventId: r.eventId, success: 0, fail: 0 };
    eventMap[r.eventId][r.status] = r._count;
  });

  const topEventList = Object.values(eventMap)
    .slice(0, 5)
    .map((e: any) => ({
      ...e,
      total: e.success + e.fail,
    }));

  return (
    <div className="max-w-6xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">ğŸ“Š æ¨æ’­çµ±è¨ˆ Dashboard</h1>

      {loading ? (
        <p>è¼‰å…¥ä¸­...</p>
      ) : (
        <>
          {/* æŠ˜ç·šåœ– */}
          <div className="mb-10">
            <h2 className="text-lg font-semibold mb-2">ğŸ“ˆ æ¯æ—¥æ¨æ’­è¶¨å‹¢</h2>
            <ResponsiveContainer width="100%" height={300}>
              <LineChart data={trend}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="date" />
                <YAxis allowDecimals={false} />
                <Tooltip />
                <Legend />
                <Line type="monotone" dataKey="success" stroke="#22c55e" name="æˆåŠŸ" />
                <Line type="monotone" dataKey="fail" stroke="#ef4444" name="å¤±æ•—" />
              </LineChart>
            </ResponsiveContainer>
          </div>

          {/* åœ“é¤…åœ– */}
          <div className="mb-10">
            <h2 className="text-lg font-semibold mb-2">ğŸ¥§ æ¨æ’­æˆåŠŸç‡</h2>
            <ResponsiveContainer width="100%" height={250}>
              <PieChart>
                <Pie
                  data={summaryData}
                  dataKey="value"
                  nameKey="name"
                  label
                  outerRadius={80}
                >
                  {summaryData.map((_, i) => (
                    <Cell key={i} fill={COLORS[i]} />
                  ))}
                </Pie>
                <Tooltip />
              </PieChart>
            </ResponsiveContainer>
          </div>

          {/* æ´»å‹•æ‘˜è¦ */}
          <div>
            <h2 className="text-lg font-semibold mb-2">ğŸ“‹ è¿‘æœŸæ´»å‹•æ¨æ’­è¡¨ç¾</h2>
            <table className="w-full border-collapse text-sm">
              <thead>
                <tr className="bg-gray-100">
                  <th className="border px-2 py-1">æ´»å‹• ID</th>
                  <th className="border px-2 py-1">æˆåŠŸ</th>
                  <th className="border px-2 py-1">å¤±æ•—</th>
                  <th className="border px-2 py-1">ç¸½æ•¸</th>
                </tr>
              </thead>
              <tbody>
                {topEventList.map((e: any) => (
                  <tr key={e.eventId}>
                    <td className="border px-2 py-1">{e.eventId}</td>
                    <td className="border px-2 py-1 text-green-600">{e.success}</td>
                    <td className="border px-2 py-1 text-red-600">{e.fail}</td>
                    <td className="border px-2 py-1">{e.total}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </>
      )}
    </div>
  );
};

export default PushDashboard;
âœ… æˆæœç¸½çµ
ä½ ç¾åœ¨å¯é€é /admin/push-dashboard é é¢æª¢è¦–ï¼š

ğŸ“ˆ æ¯æ—¥æ¨æ’­è®ŠåŒ–ï¼ˆLineChartï¼‰

ğŸ¥§ æˆåŠŸ vs å¤±æ•—æ¯”ç‡ï¼ˆPieChartï¼‰

ğŸ“‹ æ´»å‹•æ¨æ’­çµ±è¨ˆï¼ˆè¡¨æ ¼ï¼‰

