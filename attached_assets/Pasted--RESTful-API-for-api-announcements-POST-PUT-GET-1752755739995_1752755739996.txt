å¥½çš„ï¼ä»¥ä¸‹æ˜¯å®Œæ•´çš„ RESTful API è·¯ç”±å¯¦ä½œ for /api/announcementsï¼Œæ”¯æ´ï¼š

ğŸ“¥ æ–°å¢å…¬å‘Šï¼ˆPOSTï¼‰

ğŸ“ ç·¨è¼¯å…¬å‘Šï¼ˆPUTï¼‰

ğŸ” æŸ¥è©¢å…¨éƒ¨ / å–®ç­†ï¼ˆGETï¼‰

âŒ åˆªé™¤å…¬å‘Šï¼ˆDELETEï¼‰

â± è‡ªå‹•åˆ¤æ–·ã€Œé ç´„ç™¼å¸ƒã€èˆ‡ã€Œå³æ™‚ç™¼å¸ƒã€

âœ… è·¯ç”±æª”æ¡ˆï¼šroutes/announcements.ts
ts
è¤‡è£½
ç·¨è¼¯
import express from 'express';
import { Announcement } from '../models/announcement';
import { Member } from '../models/member';
import { Event } from '../models/event';
import { Op } from 'sequelize';

const router = express.Router();

// ğŸ“¥ å»ºç«‹å…¬å‘Š
router.post('/', async (req, res) => {
  try {
    const {
      title,
      content,
      related_event_id,
      created_by,
      audience = 'all',
      category = 'event',
      status = 'draft',
      scheduled_at,
      is_visible = true,
    } = req.body;

    const announcement = await Announcement.create({
      title,
      content,
      related_event_id: related_event_id || null,
      created_by: created_by || null,
      audience,
      category,
      status,
      scheduled_at: status === 'scheduled' ? scheduled_at : null,
      published_at: status === 'published' ? new Date() : null,
      is_visible,
    });

    res.status(201).json(announcement);
  } catch (err) {
    res.status(500).json({ error: 'å»ºç«‹å…¬å‘Šå¤±æ•—', details: err });
  }
});

// ğŸ“ æ›´æ–°å…¬å‘Š
router.put('/:id', async (req, res) => {
  try {
    const id = req.params.id;
    const {
      title,
      content,
      related_event_id,
      audience,
      category,
      status,
      scheduled_at,
      is_visible,
    } = req.body;

    const announcement = await Announcement.findByPk(id);
    if (!announcement) return res.status(404).json({ error: 'æ‰¾ä¸åˆ°å…¬å‘Š' });

    announcement.title = title ?? announcement.title;
    announcement.content = content ?? announcement.content;
    announcement.related_event_id = related_event_id ?? announcement.related_event_id;
    announcement.audience = audience ?? announcement.audience;
    announcement.category = category ?? announcement.category;
    announcement.status = status ?? announcement.status;
    announcement.scheduled_at = status === 'scheduled' ? scheduled_at : null;
    announcement.published_at = status === 'published' ? new Date() : null;
    announcement.is_visible = is_visible ?? announcement.is_visible;

    await announcement.save();
    res.json(announcement);
  } catch (err) {
    res.status(500).json({ error: 'æ›´æ–°å…¬å‘Šå¤±æ•—', details: err });
  }
});

// ğŸ” æŸ¥è©¢æ‰€æœ‰å…¬å‘Šï¼ˆå¯åŠ ç¯©é¸æ¢ä»¶ï¼‰
router.get('/', async (req, res) => {
  try {
    const { status, audience, category } = req.query;

    const where: any = {};
    if (status) where.status = status;
    if (audience) where.audience = audience;
    if (category) where.category = category;

    const results = await Announcement.findAll({
      where,
      order: [['published_at', 'DESC']],
    });

    res.json(results);
  } catch (err) {
    res.status(500).json({ error: 'æŸ¥è©¢å…¬å‘Šå¤±æ•—', details: err });
  }
});

// ğŸ” æŸ¥è©¢å–®ç­†å…¬å‘Š
router.get('/:id', async (req, res) => {
  try {
    const announcement = await Announcement.findByPk(req.params.id);
    if (!announcement) return res.status(404).json({ error: 'æ‰¾ä¸åˆ°å…¬å‘Š' });

    res.json(announcement);
  } catch (err) {
    res.status(500).json({ error: 'æŸ¥è©¢å…¬å‘Šå¤±æ•—', details: err });
  }
});

// âŒ åˆªé™¤å…¬å‘Š
router.delete('/:id', async (req, res) => {
  try {
    const announcement = await Announcement.findByPk(req.params.id);
    if (!announcement) return res.status(404).json({ error: 'æ‰¾ä¸åˆ°å…¬å‘Š' });

    await announcement.destroy();
    res.json({ message: 'å·²åˆªé™¤å…¬å‘Š' });
  } catch (err) {
    res.status(500).json({ error: 'åˆªé™¤å…¬å‘Šå¤±æ•—', details: err });
  }
});

export default router;
âœ… è¨»å†Šè·¯ç”±ï¼šsrc/index.ts æˆ– routes/index.ts
ts
è¤‡è£½
ç·¨è¼¯
import announcementsRouter from './announcements';
app.use('/api/announcements', announcementsRouter);