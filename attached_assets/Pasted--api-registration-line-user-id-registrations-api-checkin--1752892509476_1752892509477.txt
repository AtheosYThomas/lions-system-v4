æœ¬æ­¥ç›®æ¨™ï¼š
âœ… å¯¦ä½œ /api/registrationï¼š
ä¾æ“š line_user_id æŸ¥æ‰¾æœƒå“¡

å¯«å…¥æ´»å‹•å ±åç´€éŒ„ï¼ˆregistrationsï¼‰

âœ… å¯¦ä½œ /api/checkinï¼š
é©—è­‰æ˜¯å¦æœ‰è©²æ´»å‹•å ±åç´€éŒ„

è‹¥å·²ç°½åˆ° â†’ å›å‚³éŒ¯èª¤

è‹¥å°šæœªç°½åˆ° â†’ å¯«å…¥ checkins è³‡æ–™è¡¨

ğŸ§± å¾Œç«¯æ§åˆ¶å™¨å¯¦ä½œï¼ˆTypeScript ç¯„æœ¬ï¼‰
âœ… æª”æ¡ˆï¼šsrc/controllers/registrationController.ts
ts
è¤‡è£½
ç·¨è¼¯
import { Request, Response } from 'express';
import Registration from '../models/registration';
import Member from '../models/member';

export const createRegistration = async (req: Request, res: Response) => {
  try {
    const { event_id, line_user_id, num_attendees = 1, notes = '' } = req.body;

    const member = await Member.findOne({ where: { line_user_id } });
    if (!member) return res.status(404).json({ message: 'æœƒå“¡ä¸å­˜åœ¨' });

    const registration = await Registration.create({
      event_id,
      member_id: member.id,
      num_attendees,
      notes,
    });

    res.json(registration);
  } catch (err) {
    res.status(500).json({ error: 'å ±åå¤±æ•—', details: err });
  }
};
âœ… æª”æ¡ˆï¼šsrc/controllers/checkinController.ts
ts
è¤‡è£½
ç·¨è¼¯
import { Request, Response } from 'express';
import Member from '../models/member';
import Registration from '../models/registration';
import Checkin from '../models/checkin';

export const checkinMember = async (req: Request, res: Response) => {
  try {
    const { event_id, line_user_id } = req.body;

    const member = await Member.findOne({ where: { line_user_id } });
    if (!member) return res.status(404).json({ message: 'æœƒå“¡ä¸å­˜åœ¨' });

    const registration = await Registration.findOne({
      where: { event_id, member_id: member.id }
    });
    if (!registration) return res.status(403).json({ message: 'å°šæœªå ±åï¼Œç„¡æ³•ç°½åˆ°' });

    const existing = await Checkin.findOne({
      where: { event_id, member_id: member.id }
    });
    if (existing) return res.status(400).json({ message: 'å·²ç°½åˆ°é' });

    const checkin = await Checkin.create({
      event_id,
      member_id: member.id,
      timestamp: new Date()
    });

    res.json({ checked_in: true, checkin });
  } catch (err) {
    res.status(500).json({ error: 'ç°½åˆ°å¤±æ•—', details: err });
  }
};
ğŸ” è·¯ç”±ä¸²æ¥ï¼ˆsrc/routes/api/registration.ts & checkin.tsï¼‰
routes/api/registration.ts
ts
è¤‡è£½
ç·¨è¼¯
import express from 'express';
import { createRegistration } from '../../controllers/registrationController';
const router = express.Router();

router.post('/', createRegistration);
export default router;
routes/api/checkin.ts
ts
è¤‡è£½
ç·¨è¼¯
import express from 'express';
import { checkinMember } from '../../controllers/checkinController';
const router = express.Router();

router.post('/', checkinMember);
export default router;
src/routes/api/index.ts ä¸­åŒ¯å…¥
ts
è¤‡è£½
ç·¨è¼¯
router.use('/registration', require('./registration').default);
router.use('/checkin', require('./checkin').default);